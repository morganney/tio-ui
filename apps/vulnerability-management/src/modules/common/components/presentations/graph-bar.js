import React from 'react';
import PropTypes from 'prop-types';
import { colors } from '@hivekit/core';
import { Flex, Box } from '@hivekit/layout';
import { CountGraph } from '@hivekit/count-graph';
import { PercentGraph } from '@hivekit/percent-graph';

export const GRAPH_TYPE_COUNT = 'count';
export const GRAPH_TYPE_PERCENT = 'percent';

const graphDefaults = {
    linecolor: colors.actionBlue,
    type: GRAPH_TYPE_PERCENT,
    total: 0,
    value: 0
};
const renderGraph = (graph) => {
    switch (graph.type || graphDefaults.type) {
        case GRAPH_TYPE_COUNT:
            return <CountGraph {...graphDefaults} {...graph} />;
        case GRAPH_TYPE_PERCENT:
            return <PercentGraph {...graphDefaults} {...graph} />;
        default:
            return <div>invalid graph type</div>;
    }
};

const defaultPaddingSize = 3;
const GraphBarView = ({ graphs, padding = defaultPaddingSize, version, ...props }) => {
    return (
        <Flex {...props}>
            {
                graphs.map((graph, index) => {
                    const widgetWidth = 1 / graphs.length;
                    const paddingRight = (index < graphs.length - 1)
                        ? padding
                        : 0;

                    return (
                        <Box key={index} w={widgetWidth} pr={paddingRight}>
                            {renderGraph({ version, ...graph })}
                        </Box>
                    );
                })
            }
        </Flex>
    );
};
const graphProps = {
    background: PropTypes.string,
    color: PropTypes.string,
    count: PropTypes.string,
    icon: PropTypes.node,
    label: PropTypes.string.isRequired,
    linecolor: PropTypes.string,
    total: PropTypes.number,
    type: PropTypes.oneOf([GRAPH_TYPE_COUNT, GRAPH_TYPE_PERCENT]),
    value: PropTypes.number,
    version: PropTypes.string
};
GraphBarView.propTypes = {
    graphs: PropTypes.arrayOf(PropTypes.shape(graphProps)).isRequired,
    padding: PropTypes.number,
    version: PropTypes.string
};

export { GraphBarView };
