import { STANDARD_API_ACTION } from 'tio-alloy';

import {
    EXPORT_FILE_ID_REQUEST,
    EXPORT_FILE_ID_SUCCESS,
    EXPORT_FILE_ID_ERROR,
    EXPORT_FILE_STATUS_REQUEST,
    EXPORT_FILE_STATUS_SUCCESS,
    EXPORT_FILE_STATUS_ERROR
} from './types';

// TODO: The first param here is TEMPORARY and will be passed in from the Export view
const fetchExportFileId = ({
    ids = [],
    format = 'pdf',
    report = 'vulnerabilities',
    chapter = 'vuln_by_plugin'
}, range = 0, filters = '') => {
    let request =
    `/workbenches/export?format=${format}&report=${report}&chapter=${chapter}&date_range=${range}${filters}`;

    if (ids.length) {
        for (let i = ids.length; i--;) {
            const id = ids[i];
            request = `${request}&${id.type}=${id.value}`;
        }
    }

    return {
        type: STANDARD_API_ACTION,
        meta: {
            types: [
                EXPORT_FILE_ID_REQUEST,
                EXPORT_FILE_ID_SUCCESS,
                EXPORT_FILE_ID_ERROR
            ],
            request
        }
    };
};

const fetchExportFileStatus = (fileId) => {
    return {
        type: STANDARD_API_ACTION,
        meta: {
            types: [
                EXPORT_FILE_STATUS_REQUEST,
                EXPORT_FILE_STATUS_SUCCESS,
                EXPORT_FILE_STATUS_ERROR
            ],
            request: `workbenches/export/${fileId}/status`
        }
    };
};

export {
    fetchExportFileId,
    fetchExportFileStatus
};
