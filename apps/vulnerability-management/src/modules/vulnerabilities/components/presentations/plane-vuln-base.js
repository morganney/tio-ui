import React from 'react';
import PropTypes from 'prop-types';
import { NavLink, Route, Switch } from 'react-router-dom';
import { VulnerabilitiesIcon } from '@hivekit/icon';
import { Plane, PlaneFull, PlaneFullHeader } from '@hivekit/plane';

import { PlaneActionComponent, FilterRangeComponent } from 'tio-vm/modules/common/components';
import { PlaneAssetPreviewComponent } from 'tio-vm/modules/assets/components';
import { routeClose } from 'tio-vm/modules/common/utils';
import { PLANE_FULL, ROUTE_VULN_BASE } from 'tio-vm/constants';
import {
    PluginStatsComponent,
    VulnAssetsComponent,
    VulnAssetsStatsComponent,
    VulnPluginsComponent
} from 'tio-vm/modules/vulnerabilities/components';
import {
    PlanePluginPreviewView
} from 'tio-vm/modules/vulnerabilities/components/presentations';

export class PlaneVulnBaseView extends React.Component {
    static propTypes = {
        history: PropTypes.object.isRequired,
        match: PropTypes.object.isRequired
    };

    constructor () {
        super();
        this.renderHeader = this.renderHeader.bind(this);
        this.renderContent = this.renderContent.bind(this);
        this.renderFull = this.renderFull.bind(this);
        this.onPlaneClose = this.onPlaneClose.bind(this);
    }

    onPlaneClose () {
        routeClose(ROUTE_VULN_BASE, this.props);
    }

    renderHeader () {
        const { match } = this.props;
        // TEMP styles only temp until Hive pseudo tab thing is available
        const navStyle = {
            position: 'absolute',
            top: 20,
            left: 268,
            fontSize: 20,
            borderLeft: '1px #91c0eb solid',
            lineHeight: '40px',
            paddingLeft: 16,
            fontFamily: 'open_sans_light'
        };
        const activeStyle = { borderBottom: '3px #91c0eb solid', paddingBottom: 8, color: '#fff' };
        const linkStyle = { marginLeft: 32, fontWeight: 'bold', color: '#91c0eb', textDecoration: 'none' };

        // TODO intl
        // TODO move to separate view : vuln header

        return (
            <div style={{ position: 'relative', width: '100%' }}>
                <PlaneFullHeader title='Vulnerabilities' icon={<VulnerabilitiesIcon />}>
                    <Switch>
                        <Route path={`${match.path}/plugins`} component={PluginStatsComponent} />
                        <Route path={`${match.path}/assets`} component={VulnAssetsStatsComponent} />
                    </Switch>
                </PlaneFullHeader>
                <div style={navStyle}>
                    <NavLink key={1}
                        to={`${match.url}/plugins`}
                        style={linkStyle}
                        activeStyle={activeStyle}>By Plugin</NavLink>
                    <NavLink key={2}
                        to={`${match.url}/assets`}
                        style={linkStyle}
                        activeStyle={activeStyle}>By Asset</NavLink>
                </div>
                <FilterRangeComponent />
            </div>
        );
    }

    renderContent () {
        const { match } = this.props;

        return (
            <Switch>
                <Route path={`${match.path}/plugins`} component={VulnPluginsComponent} />
                <Route path={`${match.path}/assets`} component={VulnAssetsComponent} />
            </Switch>
        );
    }

    renderFull () {
        return <PlaneFull header={this.renderHeader()} content={this.renderContent()} />;
    }

    render () {
        const { match } = this.props;

        return (
            <React.Fragment>
                <Plane
                    display={PLANE_FULL}
                    closePlane={this.onPlaneClose}
                    full={this.renderFull}>
                    <Switch>
                        <Route path={`${match.path}/plugins/:pluginid/:detail?`} component={PlanePluginPreviewView} />
                        <Route path={`${match.path}/assets/:assetid/:detail?`} component={PlaneAssetPreviewComponent} />
                    </Switch>
                </Plane>
                <PlaneActionComponent />
            </React.Fragment>
        );
    }
}
