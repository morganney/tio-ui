import React from 'react';
import PropTypes from 'prop-types';
import { injectIntl } from 'react-intl';
import { PlanePreviewAttrItem } from '@hivekit/plane';
import { Link } from '@hivekit/link';
import { Text } from '@hivekit/text';

import { messages } from 'tio-vm/modules/vulnerabilities/messages';
import { commonMessages } from 'tio-vm/modules/common/messages';

const {
    assetLink,
    plugin,
    none
} = messages;
const {
    port,
    lastSeen,
    age,
    day,
    days
} = commonMessages;

const PluginInstanceAttributes = ({
    intl,
    instance,
    isViewByPlugin
}) => {
    const {
        hostname,
        port: portNumber,
        transportProtocol,
        applicationProtocol,
        pluginName,
        pluginId,
        uuid,
        pluginLastSeen,
        instanceAge
    } = instance;
    const prt = portNumber ? `${portNumber}` : intl.formatMessage(none);
    const transport = transportProtocol ? `${transportProtocol}` : intl.formatMessage(none);
    const application = applicationProtocol ? `${applicationProtocol}` : intl.formatMessage(none);
    const portValue = `${prt}/${transport}/${application}`;
    const ageInDays = intl.formatMessage(instanceAge === 1 ? day : days, { dayValue: instanceAge });
    // TODO fix route, do not hardcode these
    const assetUrl = `/dashboards/vulnerability-management/vulnerabilities/plugins/${pluginId}/detail/asset/${uuid}`;
    const pluginUrl = `/dashboards/vulnerability-management/vulnerabilities/plugins/${pluginId}`;

    return (
        <React.Fragment>
            {isViewByPlugin ? (
                <PlanePreviewAttrItem label={intl.formatMessage(assetLink)} span={true}>
                    <Link display='block' size={1} to={assetUrl}>
                        {hostname}
                    </Link>
                </PlanePreviewAttrItem>
            ) : (
                <PlanePreviewAttrItem label={intl.formatMessage(plugin)} span={true}>
                    <Link display='block' size={1} to={pluginUrl}>
                        {pluginName}
                    </Link>
                </PlanePreviewAttrItem>
            )}
            <PlanePreviewAttrItem label={intl.formatMessage(lastSeen)} span={true}>
                <Text size={1}>
                    {pluginLastSeen}
                </Text>
            </PlanePreviewAttrItem>
            <PlanePreviewAttrItem label={intl.formatMessage(port)} span={true}>
                <Text size={1}>
                    {portValue}
                </Text>
            </PlanePreviewAttrItem>
            <PlanePreviewAttrItem label={intl.formatMessage(age)} span={true}>
                <Text size={1}>
                    {ageInDays}
                </Text>
            </PlanePreviewAttrItem>
        </React.Fragment>
    );
};

PluginInstanceAttributes.propTypes = {
    intl: PropTypes.object.isRequired,
    instance: PropTypes.object.isRequired,
    isViewByPlugin: PropTypes.bool
};

export const PluginInstanceAttributesView = injectIntl(PluginInstanceAttributes);
