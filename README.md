# NextGen Tenable.io

## Requirements:
* [Git](https://git-scm.com/downloads)
* [Docker Community Edition](https://www.docker.com/community-edition)

**Note:** This repo leverages docker by default to isolate and control our build processes. Node and yarn installations are not required, since docker will pull those in and use them within the docker image.  However, if you want to build the project locally instead, you will need node installed at the recommended version, as well as yarn. Links to those are here:
* [node.js v8.5.0+](https://nodejs.org/en/download/) (see [this discussion](https://stash.corp.tenablesecurity.com/projects/TPS/repos/tio_ui/pull-requests/1/overview?commentId=69723))
* [yarn](https://yarnpkg.com/)

**Note2:** For local e2e testing we use selenium-standalone and webdriverio. In order for this to work you will need a java JDK installation. See the link here to download the [Java Platform (JDK)](http://www.oracle.com/technetwork/java/javase/downloads/index.html).

## Commands:
* `./folgers/init [--no-docker]`: Install packages for root and workspaces. It defaults to building it's dependencies using docker and storing it within the docker image, but that can be turned off and built locally using the `--no-docker` flag.

* `./folgers/launch [--target=https://qa-staging.cloud.aws.tenablesecurity.com] [--no-docker]`: Build deps (Alloy & Core) and start a development environment targeting `--target` (defaults to https://qa-develop.cloud.aws.tenablesecurity.com).  Again, by default the site will be built and run within a docker container, but that can turned off and run locally using the `--no-docker` flag.
  * Additionally, you can pass in a `--stats` flag to generate a webpack stats.json file at the project root, which can then be uploaded to a visual analyzer tool (like [Webpack Analyzer](http://webpack.github.io/analyse/)) to view detailed bundle information about the assets generated by this build.  The same option is also available for production builds as well (whose file is included in the dist/public build directory).

* `./folgers/docker [commands]`: Spins up a docker container with your project mounted within and runs the command passed in at the command line
  * **Example:** `./folgers/docker yarn run test --testPathPattern=\.unit` will start up a container and run all unit tests.

* `./folgers/stop` (while a docker container is running): Stops the running container.

* `./folgers/bash` (while a docker container is running): Launches a bash shell within the container, allowing inspection/manipulation of the contents as needed.

## Options
* `port` - Set the port the UI is served from.  
    * `yarn run dev --port 2042` will run the UI on port 2042, and automatically open `http://localhost:2042` in the browser.
* `browser` - Set the browser that BrowserSync will use to automatically open when the dev build is complete. Supports `chrome`, `firefox`, `safari` for now. Note: this only effects local builds that directly use `yarn`, docker builds are unaffected by this option.
    * `yarn run dev --browser safari` will run the dev build and open `http://localhost:3333` in Safari.
* `no-open` - If this option is present, BrowserSync will not attempt to automatically open the developer's browser when the dev build completes. Note: this only effects local builds that directly use `yarn`, docker builds are unaffected by this option.
    * `yarn run dev --no-open` will expect the developer to manually open `http://localhost:3333` in their browser of choice when the build is complete.
* `skip-tests` - Skip running tests during development.
    * `yarn run dev --skip-tests` will not run any jest tests during initial build or upon file changes.

## [BrowserSync.io](https://www.browsersync.io/)

The NextGen UI developer environment leverages the BrowserSync plugin for its many uses, most notibly the ability to reload the browser view when new assets are built (such as rebuilds triggered from a gulp watch).  Developers can also access the browsersync control panel for further debugging of their applications by changing their port number:

* Port 3333 - loads the UI proxied through BrowserSync
* Port 3334 - loads the BrowserSync control panel
* Port 3335 - loads the UI by itself (no BrowserSync)

## Running End to End tests

To run our e2e test suite locally you need to launch the dev mode proxy `yarn run dev` and then run the test command `yarn run locale2e`

## Running with CurrentGen UI ([webui-frontend](https://stash.corp.tenablesecurity.com/projects/TPS/repos/webui_frontend/browse/))

In production, users have the ability to navigate between views on both the NextGen and CurrentGen UIs by clicking on links or navigating to the urls directly.

View and assets belonging to the NextGen UI have their urls prefixed using the *"/tio"* string, whereas those belonging to the CurrentGen are referenced from the root path "/".

Developers also have the ability to do this locally.  By starting up the servers in both projects, the NextGen server has the ability to identify CurrentGen requests and reverse proxy them from the CurrentGen server.  Simply...
* Clone the [CurrentGen repository](https://stash.corp.tenablesecurity.com/projects/TPS/repos/webui_frontend/browse/) in another folder outside of this project.

* Follow the instructions in that project for installing and running its dev proxy.

* Start up the NextGen dev proxy, using the commands listed above (works for docker and non-docker users).

Now, the next time you try to navigate to a CurrentGen view from within the NextGen domain/port, say for example...

http://localhost:3333#/development.html#/dashboards/workbench/vulnerabilities/plugin

...you'll see those views loaded into the browser as if it was apart of the website.

**Note:** By default, the proxy assumes that the CurrentGen UI is being served from http://localhost:3000. If the developer changes the default port, then NextGen proxy needs to be informed of this by adding ```--webui-port=<CurrentGen port>``` to the script call when you start it up.

**Warning:** By default, both proxies will be pointed to the backend on qa-develop.  You do have the ability to override this default and point either of them to a different backend, just make sure you set it on both proxies!
